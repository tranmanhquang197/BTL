drop table if exists test_partition;
create table test_partition(
  id bigint(20) NOT NULL,
  xDate datetime NOT NULL
)
;
CALL create_partitions_ByRange_Datetime('test_partition', 'xDate');

ALTER TABLE test_partition PARTITION BY RANGE( to_days(xDate) ) (  PARTITION p_20190701 VALUES LESS THAN( to_days('2019-07-01') ),  PARTITION p_20190801 VALUES LESS THAN( to_days('2019-08-01') ),  PARTITION p_20190901 VALUES LESS THAN( to_days('2019-09-01') ),  PARTITION p_20191001 VALUES LESS THAN( to_days('2019-10-01') ),  PARTITION p_20191101 VALUES LESS THAN( to_days('2019-11-01') ),  PARTITION p_20191201 VALUES LESS THAN( to_days('2019-12-01') ),  PARTITION p_20200101 VALUES LESS THAN( to_days('2020-01-01') ),  PARTITION p_20200201 VALUES LESS THAN( to_days('2020-02-01') ),  PARTITION p_20200301 VALUES LESS THAN( to_days('2020-03-01') ),  PARTITION p_20200401 VALUES LESS THAN( to_days('2020-04-01') ),  PARTITION p_20200501 VALUES LESS THAN( to_days('2020-05-01') ),  PARTITION p_20200601 VALUES LESS THAN( to_days('2020-06-01') ),  PARTITION p_20200701 VALUES LESS THAN( to_days('2020-07-01') ),  PARTITION p_20200801 VALUES LESS THAN( to_days('2020-08-01') ),  PARTITION p_20200901 VALUES LESS THAN( to_days('2020-09-01') ),  PARTITION p_20201001 VALUES LESS THAN( to_days('2020-10-01') ),  PARTITION p_20201101 VALUES LESS THAN( to_days('2020-11-01') ),  PARTITION p_20201201 VALUES LESS THAN( to_days('2020-12-01') ),  PARTITION p_20210101 VALUES LESS THAN( to_days('2021-01-01') ),  PARTITION p_20210201 VALUES LESS THAN( to_days('2021-02-01') ),  PARTITION p_20210301 VALUES LESS THAN( to_days('2021-03-01') ),  PARTITION p_20210401 VALUES LESS THAN( to_days('2021-04-01') ),  PARTITION p_20210501 VALUES LESS THAN( to_days('2021-05-01') ),  PARTITION p_20210601 VALUES LESS THAN( to_days('2021-06-01') ),  PARTITION p_20210701 VALUES LESS THAN( to_days('2021-07-01') ),  PARTITION p_20210801 VALUES LESS THAN( to_days('2021-08-01') ),  PARTITION p_20210901 VALUES LESS THAN( to_days('2021-09-01') ),  PARTITION p_20211001 VALUES LESS THAN( to_days('2021-10-01') ),  PARTITION p_20211101 VALUES LESS THAN( to_days('2021-11-01') ),  PARTITION p_20211201 VALUES LESS THAN( to_days('2021-12-01') ),  PARTITION p_20220101 VALUES LESS THAN( to_days('2022-01-01') ),  PARTITION p_20220201 VALUES LESS THAN( to_days('2022-02-01') ),  PARTITION p_20220301 VALUES LESS THAN( to_days('2022-03-01') ),  PARTITION p_20220401 VALUES LESS THAN( to_days('2022-04-01') ),  PARTITION p_20220501 VALUES LESS THAN( to_days('2022-05-01') ),  PARTITION p_20220601 VALUES LESS THAN( to_days('2022-06-01') ),  PARTITION p_20220701 VALUES LESS THAN( to_days('2022-07-01') ),  PARTITION p_20220801 VALUES LESS THAN( to_days('2022-08-01') ),  PARTITION p_20220901 VALUES LESS THAN( to_days('2022-09-01') ),  PARTITION p_20221001 VALUES LESS THAN( to_days('2022-10-01') ),  PARTITION p_20221101 VALUES LESS THAN( to_days('2022-11-01') ),  PARTITION p_20221201 VALUES LESS THAN( to_days('2022-12-01') ),  PARTITION p_20230101 VALUES LESS THAN( to_days('2023-01-01') ),  PARTITION p_20230201 VALUES LESS THAN( to_days('2023-02-01') ),  PARTITION p_20230301 VALUES LESS THAN( to_days('2023-03-01') ),  PARTITION p_20230401 VALUES LESS THAN( to_days('2023-04-01') ),  PARTITION p_20230501 VALUES LESS THAN( to_days('2023-05-01') ),  PARTITION p_20230601 VALUES LESS THAN( to_days('2023-06-01') ),  PARTITION p_20230701 VALUES LESS THAN( to_days('2023-07-01') ),  PARTITION p_20230801 VALUES LESS THAN( to_days('2023-08-01') ),  PARTITION future VALUES LESS THAN MAXVALUE );


DROP PROCEDURE IF EXISTS insertData;

CREATE PROCEDURE insertData()
BEGIN
    DECLARE count bigint(20);
    SET count=0;
    loop2M: LOOP
      INSERT INTO test_partition(id, xDate) VALUES(RAND(),
        FROM_UNIXTIME(
            UNIX_TIMESTAMP(SYSDATE()) + FLOOR(RAND() + (RAND() * 63072000))
        )
      );
      SET count=count+1;
      IF count >= 2000000 THEN
          LEAVE loop2M;
      END IF;
      
    END LOOP loop2M;
END;

CALL insertData;

select count(*) from test_partition where xdate >= sysdate() and xdate < last_day(sysdate());

select count(*) from test_partition1 where xdate >= sysdate() and xdate < last_day(sysdate());

